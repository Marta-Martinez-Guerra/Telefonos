---
title: "Exploración de los datos y PCA"
author: "Marta Martínez Guerra"
date: "17/5/2023"
output:
  html_document:
    toc: true
    number_sections: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: false
    theme: lumen
    highlight: tango
  pdf_document: default
  word_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Librerías utilizadas
```{r, eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
library(dplyr)
library(GGally)
library(ggplot2)
library(ggcorrplot)
library(FactoMineR)
library(factoextra)
library(psych)
library(tidyverse)

```
# Juego de datos 

* Attribution 4.0 International (CC BY 4.0)
* Author: desconocido
* Disponible en [kaggle](https://www.kaggle.com/datasets/rkiattisak/mobile-phone-price)


```{r, include= FALSE}
datos1 <- read.csv("C:/Users/Marta Martínez/OneDrive/1Ciencia de Datos/Proyectos/Fuentes de datos/Mobile_phone_pricev2.csv", sep = ";")

```
```{r}
datos1.1 <- datos1
```

# Exploración de los datos.

A continuación, podemos ver una tabla que muestra los estadísticos básicos de cada variable, valores mínimos, máximos, media, y mediana, vemos que en todas las variables hay valores por encima del primer y tercer cuartil, en concreto en el precio, vemos que el corte del tercer cuartil se sitúa en 499 y el máximo son 1999



```{r}
knitr::kable(summary(datos1[,4:8]))


```

## ¿Cuántos modelos de móvil tenemos en cada compañía?

Tenemos 16 marcas diferentes, las que menos modelos tienen son CAT y Soni con  1 modelo,  y la que más tiene es Samsung con 79 modelos.


```{r}
knitr::kable(datos1 %>%
  group_by(Brand)%>%
  summarize(Total = n())%>%
  arrange(Total))
  
```
```{r, fig.align='center'}
level<- (c("Samsung", "Xiaomi", "Oppo","Realme", "Vivo","Apple","Nokia", "Motorola", "OnePlus",
           "Huawei","Google", "Asus", "LG", "Blackberry", "Sony", "CAT"))

datos1$Brand <- factor(datos1$Brand, levels=level)
         
datos1 %>%
  ggplot(aes(Brand)) +
  geom_bar(fill="blue")+
  theme_light()+
  theme(axis.text.x =element_text(angle= 90))+
  ggtitle("Número de modelos por comapañía")+
  theme(plot.title = element_text(hjust = 0.5))
 
 


```

## Gráfico de las variables numéricas por pares 

En este gráfico se muestra la distribución de cada variable, vemos que en algunos atributos aparece asimetría, en Price la cola está hacia la derecha y la mayor parte de los valores son menores de 500, en Screen Size tenemos un recorrido intercuartílico muy pequeño y vemos que los valores que se sitúan entre el primer y el tercer cuartil están entre 6.44 y 6.59, en los gráficos de dispersión podemos ver que algunas de las variables muestran una correlación positiva como es el caso de Storage y RAM, Storage y RAM con Price, Screen.Size con Battery, y correlación negativa como en el caso de las variables Battery y Price.

```{r, fig.align='center'}
pairs.panels(datos1[,4:8], scale = TRUE, density = TRUE, ellipses = FALSE, 
             lm = TRUE, method = 'pearson', hist.col = 'blue', main = 'Análisis de las variables')
```

## Estudio de los valores outliers

En todas las variables aparecen valores atípicos, pero hay que destacar el caso Price en el que aparece un gran número de valores por encima de 500 y el caso de Screen.Size en el que recorrido intercuartílico es muy pequeño y se sitúa en torno al 6.5.

```{r, fig.align='center'}
par(mfrow=c(2,3))
boxplot(datos1$Storage,col="blue", main = "Storage")
boxplot(datos1$RAM,col="blue",  main = "RAM")
boxplot(datos1$Screen.Size,col="blue",  main = "Screen.Size")
boxplot(datos1$Battery,col="blue",  main = "Battery")
boxplot(datos1$Price,col="blue" , main = "Price")


```


## Correlación

En este gráfico vemos con más detalle la correlación existente entre las variables que ya se mostraba en los gráficos de dispersión.

```{r, fig.align='center'}
correl <- cor(datos1[,4:8], use = "complete.obs")


ggcorrplot(correl, method = "square", type = "lower",hc.order = TRUE, hc.method = "complete",
           ggtheme = ggplot2::theme_minimal, title = "Matriz de correlación",show.legend = TRUE,
           legend.title = "Correlación", show.diag = TRUE,colors = c("blue", "white", "red"),
           outline.color = "black", lab = TRUE,lab_col = "black", lab_size = 3,
           p.mat = NULL, sig.level = 0.05,insig = c("pch", "blank"), pch = 4, pch.col = "black",
           pch.cex = 5, tl.cex = 8, tl.col = "black", tl.srt = 90)



```

## Gráficos de Dispersión

Dentro de cada marca encontramos una correlación distinta, en el caso de RAM y Storage vemos que algunas empresas tienen una correlación alta mientras que en otras la recta se sitúa casi en el plano horizontal, en el gráfico de Price y Battery incluso podemos ver algunas rectas que muestran una pendiente positiva y otras negativas.


```{r, fig.align='center', message=FALSE}
ggplot(datos1, aes(Storage, RAM, color= factor(Brand))) +
  geom_point()+
  geom_jitter()+
  theme_light() +
  ggtitle("Gráfico RAM y Storage")+
  theme(plot.title = element_text(hjust = 0.5))+
  geom_smooth(method = lm, se = FALSE)
   
```


```{r, fig.align='center', message=FALSE}
ggplot(datos1, aes(RAM, Price, color= factor(Brand))) +
  geom_point()+
  geom_jitter()+
  theme_light()+
  labs(title = "Gráfico Price y Ram")+
  geom_smooth(method = lm, se = FALSE)
   

```
```{r, fig.align='center', message=FALSE}
ggplot(datos1, aes(Battery, Price, color= factor(Brand))) +
  geom_point()+
  geom_jitter()+
  theme_light() +
  ggtitle("Gráfico Price y Battery")+
  theme(plot.title = element_text(hjust = 0.5))+
  geom_smooth(method = lm, se = FALSE)
   
```

```{r, fig.align='center', message=FALSE}
ggplot(datos1, aes(Battery, Screen.Size, color= factor(Brand))) +
  geom_point()+
  geom_jitter()+
  theme_light()+
  ggtitle("Gráfico Battery y Screen.Size")+
  theme(plot.title = element_text(hjust = 0.5))+
  geom_smooth(method = lm, se = FALSE)
   
```

# Normalización de los atributos.

```{r}
datos1.2 <- datos1
```

```{r}
datos1.2[,c("Storage")] <- (datos1$Storage-mean(datos1$Storage))/sd(datos1$Storage)
 datos1.2[,c("RAM")] <- (datos1$RAM-mean(datos1$RAM))/sd(datos1$RAM)
 datos1.2[,c("Screen.Size")] <- (datos1$Screen.Size-mean(datos1$Screen.Size))/sd(datos1$Screen.Size)
 datos1.2[,c("Battery")] <- (datos1$Battery- mean(datos1$Battery))/sd(datos1$Battery)
 datos1.2[,c("Price")] <- (datos1$Price-mean(datos1$Price))/sd(datos1$Price)
```

Para explorar los datos e identificar los grupos con características similares utilizamos un metodo de reducción de la dimensionalidad llamado Principal Component Analysis.

# Principal Component Analysis PCA

Este método de reducción de la dimensionalidad reestructura los datos de tal manera que nos permite visualizar con dos componentes o variables la mayor parte de la variación de los datos, y detectar algunos patrones en los datos.

```{r}
datos_pca <- PCA(datos1.2[,4:8], ncp = 5, graph = FALSE)
```

## Resumen del objeto PCA

Con los dos primeros componentes obtenemos  una representación del 83.017% de la variación de los datos los datos
```{r}
knitr::kable(summary(datos_pca))


```
## Aportación de cada variable a los componentes 1 y 2

En estos gráficos se muestra la aportación de cada variable a los componentes uno y dos, en el componente uno la mayor aportación la realizan las variables con correlación positiva y en el componente dos las variables con una correlación negativa.

```{r, fig.align='center'}
fviz_contrib(datos_pca, choice = "var",axes = 1, fill = "steelblue",color = "steelblue",
             sort.val = "desc",top = Inf,xtickslab.rt = 45,ggtheme = theme_minimal(), 
             title = "Contribución a PC1")

fviz_contrib(datos_pca, choice = "var",axes = 2, fill = "steelblue",color = "steelblue",
             sort.val = "desc",top = Inf,xtickslab.rt = 45,ggtheme = theme_minimal(), 
             title = "Contribución a PC2")
```

## Representación de las variables

En los dos gráficos se puede apreciar como las variables se agrupan según su correlación, RAM y Storage tienen una relación positiva con Price y tienen una mayor contribución al componente 1 mientras que Battery y Screen.Size tienen una relación negativa con Price, y se encuentran más representadas en el componente 2


```{r, fig.align='center'}

fviz_pca_var(datos_pca, col.var = "contrib",
             gradient.cols = c("#bb2eBB", "#002bbb"),
             repel =TRUE, alpha.var = 0.4)

```

```{r, fig.align='center'}
fviz_pca_biplot(datos_pca, repel=TRUE, geom.ind = "point", pointsize = 1, alpha.ind = 0.2,
                col.var ="contrib")
```

## Representación por compañía.

En este gráfico se puede ver en que posición se encuentra cada compañía
```{r, fig.align='center',warning=FALSE, message=FALSE}

fviz_pca_ind(datos_pca, label = "var", habillage = factor(datos1.2$Brand), addEllipses = TRUE,
             alpha.ind = 0.4)
```
